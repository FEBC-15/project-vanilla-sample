# 13ì¥ API ì„œë²„ ì‚¬ìš© ê°€ì´ë“œ

- API í˜¸ì¶œ URL: `https://fesp-api.koyeb.app/market`
- API ë³€ê²½ ì‚¬í•­ í™•ì¸: https://fesp-api.koyeb.app/market
- API ë¬¸ì„œ: https://fesp-api.koyeb.app/market/apidocs

## 1. ì˜¤í”ˆë§ˆì¼“ API ì„œë²„

- ì œê³µë˜ëŠ” API ì„œë²„ë¥¼ ì‚¬ìš©í•´ì„œ FrontEndë¥¼ ì™„ì„±í•˜ë©´ ë©ë‹ˆë‹¤.
- API ì„œë²„ì˜ ì£¼ì œëŠ” ì˜¤í”ˆë§ˆì¼“ì´ë©° ê²Œì‹œíŒ ê´€ë¦¬, íšŒì› ê´€ë¦¬, ìƒí’ˆ ê´€ë¦¬, êµ¬ë§¤ ê´€ë¦¬, í›„ê¸° ê´€ë¦¬ ë“±ì˜ ê¸°ëŠ¥ì´ ì œê³µë©ë‹ˆë‹¤.
- API ì„œë²„ëŠ” ëŒ€ë¶€ë¶„ì˜ ì˜¤í”ˆ ë§ˆì¼“ì— ì í•©í•˜ë„ë¡ ë²”ìš©ì ìœ¼ë¡œ ì œì‘ë˜ì–´ ìˆì–´ì„œ ì—¬ëŸ¬ë¶„ì´ êµ¬í˜„í•˜ê³  ì‹¶ì€ ê¸°ëŠ¥ì´ ì¼ë¶€ ì œê³µë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- APIì—ì„œ ì œê³µë˜ì§€ ì•ŠëŠ” ê¸°ëŠ¥ì€ ê°œë°œì„ ìš”ì²­í•´ ì£¼ì„¸ìš”. ê²€í† í›„ ìµœëŒ€í•œ ë¹ ë¥¸ ì‹œê°„ë‚´ë¡œ ì¶”ê°€í•˜ê² ìŠµë‹ˆë‹¤.

## 2. API ì„œë²„ êµ¬í˜„ ê¸°ìˆ 

- Application Server: Node.js + Express
- Database: MongoDB

## 3. DB ì´ˆê¸°í™”

- API ì„œë²„ê°€ ì‚¬ìš©í•˜ëŠ” DBì— ë°ì´í„° ì¼ë¶€ë¥¼ ë¯¸ë¦¬ ì¶”ê°€í•´ ë‘ì–´ì•¼ API í…ŒìŠ¤íŠ¸ê°€ ê°€ëŠ¥í•˜ë¯€ë¡œ ì´ë¥¼ ìœ„í•´ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰

### 3.1 DB ì´ˆê¸°í™” íŒŒì¼ ë‹¤ìš´ë¡œë“œ

- í”„ë¡œì íŠ¸ ë£¨íŠ¸ í´ë”ì—ì„œ ì‹¤í–‰í•˜ë©´ api/dbinit/brunchë‚˜ api/dbinit/nike í´ë”ì— DB ì´ˆê¸°í™” íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œ ë¨
- ì´ì „ì— ë‹¤ìš´ë¡œë“œí•œ íŒŒì¼ì„ ë®ì–´ì”Œìš°ë ¤ë©´ --force ì˜µì…˜ ì¶”ê°€

- DB ì´ˆê¸°í™” íŒŒì¼ ë‹¤ìš´ë¡œë“œ(ë¸ŒëŸ°ì¹˜ ìŠ¤í† ë¦¬)

  ```sh
  npx degit https://github.com/FEBC-API/APIServer/api/dbinit/brunch api/dbinit/readonly-brunch --force
  npx degit https://github.com/FEBC-API/APIServer/api/dbinit/brunch api/dbinit/team-brunch --force
  ```

- DB ì´ˆê¸°í™” íŒŒì¼ ë‹¤ìš´ë¡œë“œ(ë‚˜ì´í‚¤)

  ```sh
  npx degit https://github.com/FEBC-API/APIServer/api/dbinit/nike api/dbinit/readonly-nike --force
  npx degit https://github.com/FEBC-API/APIServer/api/dbinit/nike api/dbinit/team-nike --force
  ```

## 4. API ì„œë²„ í…ŒìŠ¤íŠ¸
- BrunoëŠ” Postmanê³¼ ìœ ì‚¬í•œ UIë¥¼ ì œê³µí•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ API í…ŒìŠ¤íŠ¸ ë„êµ¬
- Postmanê³¼ ì°¨ë³„ì 
  - API ìš”ì²­ ì •ë³´ë¥¼ í´ë¼ìš°ë“œì— ì €ì¥í•˜ì§€ ì•Šê³  ë¡œì»¬ì˜ íŒŒì¼ ì‹œìŠ¤í…œì— ì €ì¥
  - Gitê³¼ ê°™ì€ ë²„ì „ ê´€ë¦¬ ë„êµ¬ì™€ ì‰½ê²Œ í†µí•©ë˜ì–´ í˜‘ì—…ì´ ê°€ëŠ¥

### 4.1 Bruno ì„¤ì¹˜

- https://www.usebruno.com/downloads ì ‘ì† í›„ ë³¸ì¸ì˜ OSì— ë§ëŠ” ë²„ì „ ë‹¤ìš´ë¡œë“œ í›„ ê¸°ë³¸ ì„¤ì • ê·¸ëŒ€ë¡œ ì„¤ì¹˜

### 4.2 Collection ìƒì„±
- ì¢Œì¸¡ ìƒë‹¨ì˜ bruno ë¡œê³ (ğŸ¶) í´ë¦­
- COLLECTIONS > Create Collection
  - Name: `test-brunch`
  - Location: project-vanilla-sample/api/bruno
  - Folder Name: test-brunch
    - íŒ€ í”„ë¡œì íŠ¸ì— ì ìš©í•  ê²½ìš° team-brunch ë˜ëŠ” team-nike
  - Create

### 4.3 í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€

- test-brunch(`team-brunch`, `team-nike`) Collection ì„ íƒ
  - íŒ€ í”„ë¡œì íŠ¸ì— ì ìš©í•  ê²½ìš° team-brunch ë˜ëŠ” team-nike Collection ì„ íƒ
  - íŒì—…ì°½ì´ ëœ¨ë©´ Safe Mode ì„ íƒ í›„ Save
- Bruno ìš°ì¸¡ ìƒë‹¨ì˜ No Environment > Create
  - Environment Name: prod
    - Create
  - Add variable
    - Name: `url`
    - Value: `https://fesp-api.koyeb.app/market`
  - Add variable
    - Name: `client-id`
    - Value: `brunch`
  - Save

### 4.4 ê²Œì‹œë¬¼ ëª©ë¡ ì¡°íšŒ í…ŒìŠ¤íŠ¸

- test-brunch ì»¬ë ‰ì…˜ì— ë§ˆìš°ìŠ¤ ì˜¬ë¦° í›„ ë”ë³´ê¸°(...) > New Request
  - Type: HTTP
  - Request Name: `ê²Œì‹œë¬¼ ëª©ë¡ ì¡°íšŒ`
  - URL: GET, `{{url}}/posts`
  - Create
- Params > Add Param
  - Name: type
  - Value: brunch
- URL ìš°ì¸¡ì— ìˆëŠ” **í™”ì‚´í‘œ(->)** í´ë¦­í•´ì„œ ìš”ì²­ ì „ì†¡
- ê²°ê³¼ í™•ì¸

  ```json
  {
    "ok": 0,
    "message": "client-id í—¤ë”ê°€ ì—†ìŠµë‹ˆë‹¤."
  }
  ```

### 4.5 í—¤ë”ì— client-id ì¶”ê°€

- ë§¤ ìš”ì²­ì‹œ í—¤ë”ê°’ìœ¼ë¡œ client-idë¥¼ ìë™ìœ¼ë¡œ ë³´ë‚´ê¸° ìœ„í•œ ì„¤ì •

- test-brunch ì»¬ë ‰ì…˜ì— ë§ˆìš°ìŠ¤ ì˜¬ë¦° í›„ ë”ë³´ê¸°(...) > Settings > Headers > Add Header
  - Name: `client-id`
  - Value: `{{client-id}}`
  - Save

- [ê²Œì‹œë¬¼ ëª©ë¡ ì¡°íšŒ] í…ŒìŠ¤íŠ¸

### 4.6 ê²Œì‹œë¬¼ ë¶ë§ˆí¬ ì¶”ê°€ í…ŒìŠ¤íŠ¸

- test-brunch ì»¬ë ‰ì…˜ì— ë§ˆìš°ìŠ¤ ì˜¬ë¦° í›„ ë”ë³´ê¸°(...) > New Request
  - Type: HTTP
  - Request Name: `ê²Œì‹œë¬¼ ë¶ë§ˆí¬ ì¶”ê°€`
  - URL: POST, `{{url}}/bookmarks/post`
  - Create

- Body > No Body ì„ íƒ í›„ JSONìœ¼ë¡œ ìˆ˜ì • í›„ ì…ë ¥

  ```json
  {
    "target_id": 3,
    "memo": "ê²Œì‹œíŒ ì‚¬ìš©ë²• ë¶ë§ˆí¬"
  }
  ```

- URL ìš°ì¸¡ì— ìˆëŠ” **í™”ì‚´í‘œ(->)** í´ë¦­í•´ì„œ ìš”ì²­ ì „ì†¡

- ì—ëŸ¬ í™•ì¸

  - ë¡œê·¸ì¸ í›„ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” API ì´ë¯€ë¡œ ë¡œê·¸ì¸ì´ ì„ í–‰ë˜ì–´ì•¼ í•¨.

  ```json
  {
    "ok": 0,
    "message": "authorization í—¤ë”ê°€ ì—†ìŠµë‹ˆë‹¤.",
    "errorName": "EmptyAuthorization"
  }
  ```

### 4.7 ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸

- test-brunch ì»¬ë ‰ì…˜ì— ë§ˆìš°ìŠ¤ ì˜¬ë¦° í›„ ë”ë³´ê¸°(...) > New Request
  - Type: HTTP
  - Request Name: `ë¡œê·¸ì¸`
  - URL: POST, `{{url}}/users/login`
  - Create

- Body > No Body ì„ íƒ í›„ JSONìœ¼ë¡œ ìˆ˜ì • í›„ ì…ë ¥

  ```json
  {
    "email": "w1@market.com",
    "password": "11111111"
  }
  ```

- URL ìš°ì¸¡ì— ìˆëŠ” **í™”ì‚´í‘œ(->)** í´ë¦­í•´ì„œ ìš”ì²­ ì „ì†¡

- Response í™•ì¸
  - ë¡œê·¸ì¸ ì„±ê³µì‹œ ì‘ë‹µë°ì´í„°ì— JWT í† í°ì´ item.token.accessToken, item.token.refreshToken ì†ì„±ìœ¼ë¡œ ì „ë‹¬ë¨
  - ë¡œê·¸ì¸ì´ í•„ìš”í•œ API ìš”ì²­ì‹œ ì‚¬ìš©ì ì¸ì¦ì„ ìœ„í•´ì„œ authorization í—¤ë”ì— accessTokenì„ ì „ë‹¬í•´ì•¼ í•¨

```json
{
  "ok": 1,
  "item": {
    "_id": 2,
    "email": "w1@market.com",
    "name": "AB",
    "type": "seller",
    "loginType": "email",
    "image": "https://res.cloudinary.com/ddedslqvv/image/upload/v1762755121/brunch/BJo-jUA_wX.webp",
    "extra": {
      "job": "ë§ˆì¼€í„°",
      "biography": "ì„œë¥¸ì‚´, ìƒˆë‚´ê¸° ì·¨ì¤€ìƒ",
      "keyword": [
        "ì·¨ì—…",
        "ë…¸ì…˜",
        "í¬íŠ¸í´ë¦¬ì˜¤"
      ]
    },
    "createdAt": "2025.11.10 16:51:44",
    "updatedAt": "2025.11.10 16:51:44",
    "notifications": [],
    "token": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOjIsInR5cGUiOiJzZWxsZXIiLCJuYW1lIjoiQUIiLCJlbWFpbCI6IncxQG1hcmtldC5jb20iLCJpbWFnZSI6Imh0dHBzOi8vcmVzLmNsb3VkaW5hcnkuY29tL2RkZWRzbHF2di9pbWFnZS91cGxvYWQvdjE3NjI3NTUxMjEvYnJ1bmNoL0JKby1qVUFfd1gud2VicCIsImxvZ2luVHlwZSI6ImVtYWlsIiwiaWF0IjoxNzYyNzc4NDEwLCJleHAiOjE3NjI4NjQ4MTAsImlzcyI6IkZFQkMifQ.XS--GpoA9WgS6ryuy33zk9sCnwL2MCPrp7aapTLUD8A",
      "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NjI3Nzg0MTAsImV4cCI6MTc2NTM3MDQxMCwiaXNzIjoiRkVCQyJ9.rcszVBErux6uKYjVCfBYADQXmERVcJSkDUu_Mg7rw4k"
    }
  }
}
```

### 4.8 Collectionì— ë¡œê·¸ì¸ ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€

#### í† í°ê°’ ì €ì¥
- ë¡œê·¸ì¸ ì„±ê³µ í›„ ë°›ì€ í† í°ê°’ì„ í™˜ê²½ ë³€ìˆ˜ì— ì €ì¥

- test-brunch ì»¬ë ‰ì…˜ì— ë§ˆìš°ìŠ¤ ì˜¬ë¦° í›„ ë”ë³´ê¸°(...) > Settings
  - Script íƒ­ì˜ Post Responseì— ì¶”ê°€ í›„ Save

  ```js
  // ë¡œê·¸ì¸ ì„±ê³µ í›„
  if(res.status === 200){
    if(req.url.split('?')[0] === `${bru.getEnvVar('url')}/users/login`){
      bru.setEnvVar('accessToken', res.body.item.token.accessToken);
      bru.setEnvVar('refreshToken', res.body.item.token.refreshToken);
    }else if(req.url === `${bru.getEnvVar('url')}/auth/refresh`){ // accessToken ì¬ë°œí–‰ í›„
      bru.setEnvVar('accessToken', res.body.accessToken);
    }
  }
  ```

#### ìš”ì²­ í—¤ë”ì— í† í° ì¸ì¦ ì •ë³´ ì¶”ê°€

- í™˜ê²½ ë³€ìˆ˜ì— ì¶”ê°€í•œ í† í°ì„ ìš”ì²­ í—¤ë”ì— ìë™ìœ¼ë¡œ ì¶”ê°€

- test-brunch ì»¬ë ‰ì…˜ì— ë§ˆìš°ìŠ¤ ì˜¬ë¦° í›„ ë”ë³´ê¸°(...) > Settings
  - Auth > No Auth í´ë¦­í•´ì„œ Bearer Token ì„ íƒ
  - Token: `{{accessToken}}`
  - Save

### 4.9 ê²Œì‹œë¬¼ ë¶ë§ˆí¬ ì¶”ê°€ í…ŒìŠ¤íŠ¸

- [ë¡œê·¸ì¸] ìš”ì²­ í›„ì— í™˜ê²½ ë³€ìˆ˜ê°’ accessToken, refreshTokenì´ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
  - [ë¡œê·¸ì¸] ìš”ì²­
  - Bruno ìš°ì¸¡ ìƒë‹¨ì˜ prod > Configure ì„ íƒí•œ í›„ accessToken, refreshToken ë³€ìˆ˜ í™•ì¸ í›„ ë‹«ê¸°
- [ê²Œì‹œë¬¼ ë¶ë§ˆí¬ ì¶”ê°€] > Auth > `No Auth`ì¼ ê²½ìš° `Inherit` ë³€ê²½ í›„ ìš”ì²­ ì „ì†¡
  - ê²°ê³¼ í™•ì¸
  ```json
  {
    "ok": 1,
    "item": {
      "type": "post",
      "user_id": 2,
      "target_id": 3,
      "user": {
        "_id": 2,
        "name": "AB",
        "email": "w1@market.com",
        "image": "https://res.cloudinary.com/ddedslqvv/image/upload/v1762755121/brunch/BJo-jUA_wX.webp"
      },
      "memo": "ê²Œì‹œíŒ ì‚¬ìš©ë²• ë¶ë§ˆí¬",
      "_id": 11,
      "createdAt": "2025.11.11 10:46:00"
    }
  }
  ```

### 4.10 ìƒ˜í”Œ Bruno íŒŒì¼ ë‹¤ìš´ë¡œë“œ

- í”„ë¡œì íŠ¸ ë£¨íŠ¸ í´ë”ì—ì„œ ì‹¤í–‰í•˜ë©´ api/bruno/brunchë‚˜ api/bruno/nike í´ë”ì— ë‹¤ìš´ë¡œë“œ ë¨
- ì´ì „ì— ë‹¤ìš´ë¡œë“œí•œ íŒŒì¼ì„ ë®ì–´ì”Œìš°ë ¤ë©´ --force ì˜µì…˜ ì¶”ê°€

- ìƒ˜í”Œ Bruno íŒŒì¼ ë‹¤ìš´ë¡œë“œ(ë¸ŒëŸ°ì¹˜ ìŠ¤í† ë¦¬)

  ```sh
  npx degit https://github.com/FEBC-API/APIServer/api/bruno/brunch api/bruno/readonly-brunch --force
  npx degit https://github.com/FEBC-API/APIServer/api/bruno/brunch api/bruno/team-brunch --force
  ```

- ìƒ˜í”Œ Bruno íŒŒì¼ ë‹¤ìš´ë¡œë“œ(ë‚˜ì´í‚¤)

  ```sh
  npx degit https://github.com/FEBC-API/APIServer/api/bruno/nike api/bruno/readonly-nike --force
  npx degit https://github.com/FEBC-API/APIServer/api/bruno/nike api/bruno/team-nike --force
  ```

- Bruno > Collection > Open Collectionìœ¼ë¡œ ë‹¤ìš´ë¡œë“œí•œ ì»¬ë ‰ì…˜ ì¶”ê°€ í›„ í…ŒìŠ¤íŠ¸

## 5. íŒ€ í”„ë¡œì íŠ¸ì— ì ìš©
- ë””ìŠ¤ì½”ë“œ íŒ€ ì±„ë„ì—ì„œ íŒ€ì›ì¤‘ í•œëª…ì´ í™”ë©´ ê³µìœ í•´ì„œ ì§„í–‰

### 5.1 íŒ€ í”„ë¡œì íŠ¸ DB ì´ˆê¸°í™”
- íŒ€ í”„ë¡œì íŠ¸ í´ë”ì—ì„œ [3. DB ì´ˆê¸°í™”](#3-db-ì´ˆê¸°í™”) ì‘ì—… ìˆ˜í–‰
- api/dbinit/team-bruno, api/dbinit/team-nike í´ë”ì˜ íŒŒì¼ì„ íŒ€ì— ë§ê²Œ ìˆ˜ì • í›„ [DB ì´ˆê¸°í™”](https://fesp-api.koyeb.app/market/apidocs/#/%EC%8B%9C%EC%8A%A4%ED%85%9C/post_db_init) ì‘ì—… ì‹¤í–‰

### 5.2 íŒ€ í”„ë¡œì íŠ¸ API ì„œë²„ í…ŒìŠ¤íŠ¸
- íŒ€ í”„ë¡œì íŠ¸ í´ë”ì—ì„œ [4.10 ìƒ˜í”Œ Bruno íŒŒì¼ ë‹¤ìš´ë¡œë“œ](#410-ìƒ˜í”Œ-bruno-íŒŒì¼-ë‹¤ìš´ë¡œë“œ) ì‘ì—… ìˆ˜í–‰
- í™˜ê²½ë³€ìˆ˜ prodì˜ client-idëŠ” ê° íŒ€ì—ê²Œ ë¶€ì—¬ëœ ê°’ `febc15-vanillaíŒ€ë²ˆí˜¸-ecad`ìœ¼ë¡œ ìˆ˜ì •
  - 5íŒ€ ì˜ˆì‹œ, `febc15-vanilla05-ecad`

#### íŒ€ ë ˆí¬ì§€í† ë¦¬ì— ë°˜ì˜
- ìˆ˜í–‰í•œ ì‘ì—…ì— ëŒ€í•œ PR ìƒì„± í›„ push

#### ë‹´ë‹¹ ê¸°ëŠ¥ì— ëŒ€í•œ API í…ŒìŠ¤íŠ¸
- íŒ€ì›ì€ pull ë°›ì€ í›„ ë‹´ë‹¹ ê¸°ëŠ¥ì— ëŒ€í•œ API í…ŒìŠ¤íŠ¸ ì¶”ê°€
  - api/bruno/readonly-brunch, api/bruno/readonly-nike ì°¸ê³ 

### 5.3 VSCode ì„¤ì •ì— readonly í´ë” ì¶”ê°€
- ì œê³µëœ ì°¸ê³  íŒŒì¼ì„ ì‹¤ìˆ˜ë¡œ ìˆ˜ì •í•˜ëŠ”ê±¸ ë§‰ê¸° ìœ„í•´ VSCodeì˜ ì½ê¸° ì „ìš© ì˜µì…˜ ì¶”ê°€

- File > Preferences > Settings > Workspace
  - Search settings ì—ì„œ Files: Readonly Include ê²€ìƒ‰
  - Add Pattern > `api/**/readonly-*` ì…ë ¥í•œ í›„ OK ì„ íƒí•˜ë©´ ë‹¤ìŒì˜ í´ë”ëŠ” ì „ë¶€ VSCodeì—ì„œ ì½ê¸° ì „ìš©ì´ ë¨
    - api/dbinit/readonly-brunch
    - api/dbinit/readonly-nike 
    - api/bruno/readonly-brunch
    - api/bruno/readonly-nike
